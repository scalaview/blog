<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>王见充时光</title>
  <meta name="author" content="Benko bin">
  
  <meta name="description" content="Traits and GenericsNow that we understand a type that’s sorta generic, vectors, we can talkabout how generic functions work. Then, we can use traits t">
  
  
  
  <meta property="og:site_name" content="王见充时光"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.ico" >
   <link rel="alternate" href="http://xxx.xx/atom.xml" title="王见充时光" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">王见充时光</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 20px;">Android</a><a href="/tags/Data-Storage/" style="font-size: 10px;">Data Storage</a><a href="/tags/Java/" style="font-size: 15px;">Java</a><a href="/tags/Jquery/" style="font-size: 10px;">Jquery</a><a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a><a href="/tags/Service/" style="font-size: 10px;">Service</a><a href="/tags/Thread/" style="font-size: 10px;">Thread</a><a href="/tags/listView/" style="font-size: 10px;">listView</a><a href="/tags/优化/" style="font-size: 10px;">优化</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2016 Benko bin
  
</div>



</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">王见充时光</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"></h1>
  

      <time datetime="2016-11-07T02:43:08.792Z"><a href="/2016/11/07/rust_for_rubyists/chapter-10/">2016-11-07</a></time>
      
  </header>
    <div class="entry">
      
        <h1 id="Traits_and_Generics">Traits and Generics</h1><p>Now that we understand a type that’s sorta generic, vectors, we can talk<br>about how generic functions work. Then, we can use traits to make<br>functions that work on generic monsters.</p>
<h2 id="Writing_functions_that_work_with_vectors">Writing functions that work with vectors</h2><p>Because you’re still getting used to Rust code, let’s implement two<br>versions of a method that print everything in a vector, and then<br>refactor that into the generic form.</p>
<p>Let’s do an exercise. You have this code:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Implement <code>print_vec</code> so that it puts out <code>1 2 3</code> with newlines between<br>them. Hint: You can write ‘I want an array of ints’ with <code>&amp;[int]</code>.<br>Remember how functions can often use borrowed pointers?</p>
<p>I’ll wait.</p>
<p>Done? I got this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>(v: &amp;[<span class="keyword">int</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;:d&#125;"</span>, *i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Pretty straightforward. We take a slice (remember, ‘borrowed vector’ ==<br>‘slice’) of ints, get a borrowed pointer to each of them, and print them<br>out.</p>
<p>Round two: Implement this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec_str(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You’ll often be seeing owned pointers with strings. Go ahead. You can do it!</p>
<p>I got this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>(v: &amp;[<span class="keyword">int</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;:d&#125;"</span>, *i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec_str</span></span>(v: &amp;[&amp;<span class="keyword">str</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;:s&#125;"</span>, *i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec_str(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You’ll notice we had to declare what type of <code>str</code> we had. See, strings<br>are actually implemented as vectors of characters (encoded in UTF-8), so<br>while they are sorta a type, you can’t have just <code>str</code> as a type. You<br>gotta say <code>&amp;str</code>. As I mentioned before, there is also a mutable,<br>heap-allocated string type, <code>Str</code>.</p>
<p>Okay, obviously, this situation sucks! What can we do?</p>
<p>We can use generics!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>&lt;T&gt;(v: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This won’t compile, but it is closer. Let’s examine that signature more<br>closely.</p>
<ul>
<li><code>&lt;T&gt;</code> says that we’re going to be making this function polymorphic<br>over the type T.</li>
<li>We then use it later to say we take a borrowed pointer of a vector<br>of <code>T</code> s, <code>&amp;[T]</code></li>
</ul>
<p>If you try to compile this, you’ll get an error:</p>
<pre><code>$ rustc traits<span class="class">.rs</span> &amp;&amp; ./traits
traits<span class="class">.rs</span>:<span class="number">3</span>:<span class="number">28</span>: <span class="number">3</span>:<span class="number">29</span> error: failed to find an implementation of trait core::fmt::Show <span class="keyword">for</span> T
traits<span class="class">.rs</span>:<span class="number">3</span>             println!(<span class="string">"{}"</span>, i)
                                    ^
note: <span class="keyword">in</span> expansion of format_args!
&lt;std macros&gt;:<span class="number">2</span>:<span class="number">23</span>: <span class="number">2</span>:<span class="number">77</span> note: expansion site
&lt;std macros&gt;:<span class="number">1</span>:<span class="number">1</span>: <span class="number">3</span>:<span class="number">2</span> note: <span class="keyword">in</span> expansion of println!
traits<span class="class">.rs</span>:<span class="number">3</span>:<span class="number">13</span>: <span class="number">4</span>:<span class="number">10</span> note: expansion site
</code></pre><p>This is a problem. Our generic type T does not have any restrictions on<br>what kind of thing it is, which means we can’t guarantee that we’ll get<br>something that has the ability to be displayed.</p>
<p>For that, we need Traits.</p>
<h2 id="Traits">Traits</h2><p>This <strong>will</strong> work:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>&lt;T: std::fmt::Show&gt;(v: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>&lt;T: std::fmt::Show&gt;</code> says: “We take any type <code>T</code> that implements the <code>Show</code><br>trait.</p>
<p>Traits are sort of like ‘static duck typing’ or ‘structural typing.’ We<br>get away with this in Ruby by just trusting the code we write, and for<br>most of it, it just works out. Think about this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def print_each(arr)&#10;  arr.each do |i|&#10;    puts i&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<p>We trust that this will always work, because <code>Object</code> implements<br><code>#to_s</code>. But if we had this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def print_each(arr)&#10;  arr.each do |i|&#10;    puts i + 1&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<p>We have an implicit type here: <code>arr</code> must contain things that<br><code>respond_to?(:+)</code>. In many ways, Rust is sorta like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def print_each(arr)&#10;  assert arr.respond_to?(:+)&#10;&#10;  arr.each do |i|&#10;    puts i + 1&#10;  end&#10;end</span><br></pre></td></tr></table></figure>
<p>But it happens at compile time, not run time.</p>
<p>Now, I’ve never written code where I felt the need to check for a<br><code>NoMethodError</code> or <code>TypeError</code>, as you’d get in Ruby:</p>
<pre><code>irb(main):<span class="number">007</span>:<span class="number">0</span>&gt; print_each([<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>])
TypeError: can<span class="comment">'t convert Fixnum into String</span>
  <span class="keyword">from</span> (irb):<span class="number">3</span>:<span class="keyword">in</span> `+<span class="comment">'</span>
  <span class="keyword">from</span> (irb):<span class="number">3</span>:<span class="keyword">in</span> `block <span class="keyword">in</span> print_each<span class="comment">'</span>
  <span class="keyword">from</span> (irb):<span class="number">2</span>:<span class="keyword">in</span> `<span class="keyword">each</span><span class="comment">'</span>
  <span class="keyword">from</span> (irb):<span class="number">2</span>:<span class="keyword">in</span> `print_each<span class="comment">'</span>
  <span class="keyword">from</span> (irb):<span class="number">7</span>
  <span class="keyword">from</span> /usr/local/ruby-<span class="number">1.9</span>.3-p327/bin/irb:<span class="number">12</span>:<span class="keyword">in</span> `&lt;main&gt;<span class="comment">'</span>
</code></pre><p>But I think that safety is the wrong way to look at this kind of static<br>typing. The right way to look at it is that by giving the compiler more<br>information about our code, it can make certain optimizations. Check<br>this out:</p>
<pre><code><span class="variable">$ </span>cat traits.rs
</code></pre><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>&lt;T: std::fmt::Show&gt;(v: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code><span class="variable">$ </span>rustc traits.rs &amp;&amp; ./traits
<span class="number">1</span>
<span class="number">2</span>
<span class="number">3</span>
hey
there
yo

<span class="variable">$ </span>nm -<span class="constant">C </span>traits | grep vec
<span class="number">0000000000401500</span> t <span class="symbol">print_vec_2912:</span><span class="symbol">:_85e5a3bc2d3e1a83</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>ee<span class="number">0</span> t <span class="symbol">print_vec_2912:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_2970</span>
<span class="number">0000000000404</span>cd<span class="number">0</span> t <span class="symbol">print_vec_3218:</span><span class="symbol">:_f1e1b4437dbb28a</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004054</span>8<span class="number">0</span> t <span class="symbol">print_vec_3218:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_3252</span>
<span class="number">0000000000402</span>c5<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_3030</span><span class="symbol">:</span><span class="symbol">:_de1a9d6344b57ab</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000402</span>d7<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:capacity_3032</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>b5<span class="number">0</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:push_fast_3194</span><span class="symbol">:</span><span class="symbol">:_5cf6fa3bfa6090d7</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>ae<span class="number">0</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_at_least_3192</span><span class="symbol">:</span><span class="symbol">:_de1a9d6344b57ab</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>84<span class="number">0</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_no_inline_3182</span><span class="symbol">:</span><span class="symbol">:_24c451fdab89623e</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>c5<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_2959</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>e8<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_2959</span><span class="symbol">:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_2968</span>
<span class="number">0000000000404</span>8b<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3185</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>a8<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3185</span><span class="symbol">:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_3190</span>
<span class="number">00000000004051</span>f<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3243</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000405420</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3243</span><span class="symbol">:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_3250</span>
<span class="number">0000000000401</span>a5<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:iter_2947</span><span class="symbol">:</span><span class="symbol">:_d7a5bdd54e5e6f77</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004050</span>a<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:iter_3237</span><span class="symbol">:</span><span class="symbol">:_55446721964a82e1</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004016</span>8<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:next_2919</span><span class="symbol">:</span><span class="symbol">:_5079d793a0f371c9</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>e5<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:next_3224</span><span class="symbol">:</span><span class="symbol">:_b423b136d356fe1d</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004047</span>9<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:push_3179</span><span class="symbol">:</span><span class="symbol">:_a91dd4803fb62a</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>d0<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:as_imm_buf_2961</span><span class="symbol">:</span><span class="symbol">:_caa46d7965b990b9</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>97<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:as_imm_buf_3187</span><span class="symbol">:</span><span class="symbol">:_62a416e4b98acea8</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004052</span>a<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:as_imm_buf_3245</span><span class="symbol">:</span><span class="symbol">:_cb6b3bad8005286</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>b3<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:raw</span><span class="symbol">:</span><span class="symbol">:to_ptr_2950</span><span class="symbol">:</span><span class="symbol">:_1df29a3554bbd95b</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">00000000004051</span>8<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:raw</span><span class="symbol">:</span><span class="symbol">:to_ptr_3240</span><span class="symbol">:</span><span class="symbol">:_8c11f86a3948f562</span><span class="symbol">:</span><span class="symbol">:_00</span>
                 <span class="constant">U</span>
                 <span class="symbol">vec:</span><span class="symbol">:rustrt</span><span class="symbol">:</span><span class="symbol">:vec_reserve_shared_actual</span><span class="symbol">:</span><span class="symbol">:_c688b9b8fd5bf21</span><span class="symbol">:</span><span class="symbol">:_07</span>


<span class="variable">$ </span>mvim traits.rs
....editing...
<span class="variable">$ </span>cat traits.rs
</code></pre><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>&lt;T: std::fmt::Show&gt;(v: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code><span class="variable">$ </span>rustc traits.rs &amp;&amp; ./traits

<span class="variable">$ </span>nm -<span class="constant">C </span>traits | grep vec
<span class="number">00000000004012</span>d<span class="number">0</span> t <span class="symbol">print_vec_2908:</span><span class="symbol">:_85e5a3bc2d3e1a83</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>cb<span class="number">0</span> t <span class="symbol">print_vec_2908:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_2966</span>
<span class="number">0000000000402</span>a2<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_3026</span><span class="symbol">:</span><span class="symbol">:_de1a9d6344b57ab</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000402</span>b4<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:capacity_3028</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>92<span class="number">0</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:push_fast_3190</span><span class="symbol">:</span><span class="symbol">:_5cf6fa3bfa6090d7</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>8b<span class="number">0</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_at_least_3188</span><span class="symbol">:</span><span class="symbol">:_de1a9d6344b57ab</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404610</span> t
<span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:reserve_no_inline_3178</span><span class="symbol">:</span><span class="symbol">:_24c451fdab89623e</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>a2<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_2955</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>c5<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_2955</span><span class="symbol">:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_2964</span>
<span class="number">00000000004046</span>8<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3181</span><span class="symbol">:</span><span class="symbol">:_824484774e7757</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404</span>85<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:len_3181</span><span class="symbol">:</span><span class="symbol">:anon</span><span class="symbol">:</span><span class="symbol">:expr_fn_3186</span>
<span class="number">0000000000401</span>82<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:iter_2943</span><span class="symbol">:</span><span class="symbol">:_d7a5bdd54e5e6f77</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401450</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:next_2915</span><span class="symbol">:</span><span class="symbol">:_5079d793a0f371c9</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404560</span> t <span class="symbol">vec:</span><span class="symbol">:__extensions__</span><span class="symbol">:</span><span class="symbol">:push_3175</span><span class="symbol">:</span><span class="symbol">:_a91dd4803fb62a</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>ad<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:as_imm_buf_2957</span><span class="symbol">:</span><span class="symbol">:_caa46d7965b990b9</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000404740</span> t <span class="symbol">vec:</span><span class="symbol">:as_imm_buf_3183</span><span class="symbol">:</span><span class="symbol">:_62a416e4b98acea8</span><span class="symbol">:</span><span class="symbol">:_00</span>
<span class="number">0000000000401</span>90<span class="number">0</span> t <span class="symbol">vec:</span><span class="symbol">:raw</span><span class="symbol">:</span><span class="symbol">:to_ptr_2946</span><span class="symbol">:</span><span class="symbol">:_1df29a3554bbd95b</span><span class="symbol">:</span><span class="symbol">:_00</span>
                 <span class="constant">U</span>
                 <span class="symbol">vec:</span><span class="symbol">:rustrt</span><span class="symbol">:</span><span class="symbol">:vec_reserve_shared_actual</span><span class="symbol">:</span><span class="symbol">:_c688b9b8fd5bf21</span><span class="symbol">:</span><span class="symbol">:_07</span>
</code></pre><p>Okay. So the first time we have our code, we have two calls to<br><code>print_vec</code>, one for a vector of strings and one for a vector of ints.<br>The call to <code>nm</code>…</p>
<p>Oh wait, I mentioned <code>nm</code> before, but let me tell you some more about it now!</p>
<h2 id="A_diversion_about_nm">A diversion about nm</h2><p>Here’s what my manpage says:</p>
<pre><code>$ <span class="keyword">man</span> nm

NAME
       nm - <span class="keyword">display</span> name <span class="keyword">list</span> (symbol <span class="keyword">table</span>)

SYNOPSIS
       nm  [  -agnoprumxjlfPA  [  s segname sectname ]] [ - ] [ -t <span class="keyword">format</span> ] [[
       -<span class="keyword">arch</span> arch_flag ]...] [ <span class="keyword">file</span> ... ]

DESCRIPTION
       Nm displays the name <span class="keyword">list</span> (symbol <span class="keyword">table</span>) of each  object  <span class="keyword">file</span>  <span class="keyword">in</span>  the
       argument <span class="keyword">list</span>.
</code></pre><p>Cool! You’ve never had to think about symbol tables before, so let’s<br>talk about them.</p>
<p>When your compiler compiles something, you get an ‘object file’ out of<br>it. This is the binary that you run: <code>rustc fizzbuzz.rs</code> produces<br><code>fizzbuzz</code>. This object file will contain a list of <code>symbols</code> and where<br>they exist in memory. This matters when we want to write two bits of<br>code that work together: If my library exposes a function called<br><code>my_function</code>, and you want to use it, the compiler needs to know where<br>to find <code>my_function</code> in my library’s code. The compiler ‘mangles’ the<br>names to fit its own scheme. This is called an “ABI”, or application<br>binary interface. Have you ever seen this:</p>
<pre><code><span class="regexp">/Users/</span>Steve<span class="regexp">/.rvm/</span>rubies<span class="regexp">/ruby-1.9.3-p286/</span>lib<span class="regexp">/ruby/</span><span class="number">1.9</span>.<span class="number">1</span>
</code></pre><p>And wondered why that 1.9.1 is there? That’s because Ruby 1.9.3 and Ruby<br>1.9.1 both share the same ABI, so gems that are linked against 1.9.1 can<br>also be used with 1.9.3. They use the same scheme to generate symbols.</p>
<p>Anyway, <code>nm</code> can show us this information. The first column is the<br>location in memory, the second is the (mangled) name:</p>
<pre><code>0000000100001bb8 S _rust_abi_version
</code></pre><p>That’s a fun, recursive symbol ;) Anyway, we can examine what symbols<br>Rust exports to see some information about our executable, that’s my<br>intention with <code>nm</code> in this case.</p>
<h2 id="Back_to_our_regularly_scheduled_investigation">Back to our regularly scheduled investigation</h2><p>Here’s the important part of the two outputs of nm:</p>
<pre><code><span class="number">0000000000401500</span> t print_vec_2912::_85e5a3bc2d3e1a83::_00
<span class="number">0000000000401</span>ee0 t print_vec_2912::anon::expr_fn_2970
<span class="number">0000000000404</span>cd0 t print_vec_3218::_f1e1b4437dbb28a::_00
<span class="number">0000000000405480</span> t print_vec_3218::anon::expr_fn_3252
</code></pre><p>and:</p>
<pre><code><span class="number">00000000004012</span>d0 t print_vec_2908::_85e5a3bc2d3e1a83::_00
<span class="number">0000000000401</span>cb0 t print_vec_2908::anon::expr_fn_2966
</code></pre><p>See how they both have <code>print_vec</code>? These are the functions we made. And<br>without even knowing what’s happening, you can see the difference: in<br>the version of our code where we call <code>print_vec</code> on strings and ints,<br>we have two versions of the function, and on the version where we just<br>call it on ints, we have one version.</p>
<p>Neat! We get specialized versions, but only specialized for the types we<br>actually use. No generating code that’s useless. This process is called<br>‘monomorphization,’ which basically means we take something that can work<br>with things of different types and change it (morph) into specialized<br>(mono) versions. To simplify, the compiler takes this code:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec</span></span>&lt;T: std::fmt::Show&gt;(v: &amp;[T]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And turns it into:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec_str</span></span>(v: &amp;[&amp;<span class="keyword">str</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">print_vec_int</span></span>(v: &amp;[<span class="keyword">int</span>]) &#123;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> v.iter() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> vec = [<span class="number">1</span>i, <span class="number">2</span>i, <span class="number">3</span>i];</span><br><span class="line"></span><br><span class="line">    print_vec_int(vec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> str_vec = [<span class="string">"hey"</span>, <span class="string">"there"</span>, <span class="string">"yo"</span>];</span><br><span class="line"></span><br><span class="line">    print_vec_str(str_vec);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Complete with changing the calls at each call site to call the special<br>version of the function. We call this ‘static dispatch,’ as opposed to<br>the ‘dynamic dispatch’ that’d happen at runtime.</p>
<p>(I am fudging a bit here with the <code>println!</code> macro line, but it’s the correct<br>mental model. <code>{}</code> doesn’t actually work on <code>int</code>.)</p>
<p>These are the kinds of optimizations that we get with static typing.<br>Neat! I will say that there are efforts to bring this kind of<br>optimization into dynamically typed languages as well, through analyzing<br>the call site. So, for example:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def foo(arg)&#10;  puts arg&#10;end</span><br></pre></td></tr></table></figure>
<p>If we call <code>foo</code> with a <code>String</code> <code>arg</code> a bunch of times in a row, the<br>interpreter will JIT compile a version of <code>foo</code> specialized for<br><code>Strings</code>, and then replace the call site with something like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if arg.kind_of? String&#10;  __super_optimized_foo_string(arg)&#10;else&#10;  foo(arg)&#10;end</span><br></pre></td></tr></table></figure>
<p>This would give you the same benefit, without the human typing. Not just<br>that, but a sufficiently smart runtime would be able to actually<br>determine more complex situations that a person may not. And, maybe<br>after, say, 1000 calls with a String, just remove the check entirely.</p>
<p>Anyway.</p>
<h2 id="Making_our_own_Traits">Making our own Traits</h2><p>We want all of our monsters to implement <code>attack</code>. So let’s make<br><code>Monster</code> a Trait. The syntax looks like this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title">Monster</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This says that the <code>Monster</code> trait guarantees we have one method<br>available on any type that implements the trait, <code>attack</code>. Here’s how we<br>make one:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title">Monster</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    strength: <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The monkey attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> monkey = IndustrialRaverMonkey &#123; strength: <span class="number">35</span> &#125;;</span><br><span class="line"></span><br><span class="line">    monkey.attack();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we’re cooking with gas! Remember our old implementation?:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Monster &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">match</span> *<span class="keyword">self</span> &#123;</span><br><span class="line">            ScubaArgentine(l, s, c, w) =&gt; <span class="built_in">println!</span>(<span class="string">"The monster attacks for &#123;:d&#125; damage."</span>, w),</span><br><span class="line">            IndustrialRaverMonkey(l, s, c, w) =&gt; <span class="built_in">println!</span>(<span class="string">"The monster attacks for &#123;:d&#125; damage."</span>, w)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ugh. This is way better. No destructuring on types. We can write an<br>implementation for absolutely anything:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title">Monster</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    strength: <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The monkey attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> <span class="keyword">int</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The int attacks for &#123;:d&#125;."</span>, *<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> monkey = IndustrialRaverMonkey &#123; strength: <span class="number">35</span> &#125;;</span><br><span class="line">    monkey.attack();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">10</span>;</span><br><span class="line">    i.attack();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Heh. Check it:</p>
<pre><code>$ rustc dwemthy<span class="class">.rs</span> &amp;&amp; ./dwemthy
The monkey attacks <span class="keyword">for</span> <span class="number">35</span>.
The int attacks <span class="keyword">for</span> <span class="number">10</span>.
</code></pre><p>Amusing.</p>
<p>Okay, exercise: Make six different monsters, and create a vector with<br>all of them in it. Then write a method that takes the vector, and prints<br>out all of the monsters and their stats.</p>
<p>I’ll wait. It took me a little while to write this: this is the hardest<br>part of the book so far. Work through it; it’ll be painful. Don’t be<br>afraid to ask for help. I had to ask <a href="http://chat.mibbit.com/?server=irc.mozilla.org&amp;channel=%23rust" target="_blank" rel="external">the rust<br>IRC</a> for<br>help once while doing it. They’re friendly, don’t worry.</p>
<p>Done? Here’s mine:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">trait</span> <span class="title">Monster</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> DwarvenAngel &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> AssistantViceTentacleAndOmbudsman &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> TeethDeer &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> IntrepidDecomposedCyclist &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> Dragon &#123;</span><br><span class="line">    life: <span class="keyword">int</span>,</span><br><span class="line">    strength: <span class="keyword">int</span>,</span><br><span class="line">    charisma: <span class="keyword">int</span>,</span><br><span class="line">    weapon: <span class="keyword">int</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> IndustrialRaverMonkey &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The monkey attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; IndustrialRaverMonkey &#123;</span><br><span class="line">        IndustrialRaverMonkey &#123; life: <span class="number">46</span>, strength: <span class="number">35</span>, charisma: <span class="number">91</span>, weapon: <span class="number">2</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> DwarvenAngel &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The angel attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; DwarvenAngel &#123;</span><br><span class="line">        DwarvenAngel &#123; life: <span class="number">540</span>, strength: <span class="number">6</span>, charisma: <span class="number">144</span>, weapon: <span class="number">50</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> AssistantViceTentacleAndOmbudsman &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The tentacle attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; AssistantViceTentacleAndOmbudsman &#123;</span><br><span class="line">        AssistantViceTentacleAndOmbudsman &#123; life: <span class="number">320</span>, strength: <span class="number">6</span>, charisma: <span class="number">144</span>, weapon: <span class="number">50</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> TeethDeer &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The deer attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; TeethDeer &#123;</span><br><span class="line">        TeethDeer &#123; life: <span class="number">655</span>, strength: <span class="number">192</span>, charisma: <span class="number">19</span>, weapon: <span class="number">109</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> IntrepidDecomposedCyclist &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The cyclist attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; IntrepidDecomposedCyclist &#123;</span><br><span class="line">        IntrepidDecomposedCyclist &#123; life: <span class="number">901</span>, strength: <span class="number">560</span>, charisma: <span class="number">422</span>, weapon: <span class="number">105</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Monster <span class="keyword">for</span> Dragon &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">attack</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"The dragon attacks for &#123;:d&#125;."</span>, <span class="keyword">self</span>.strength)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Dragon &#123;</span><br><span class="line">        Dragon &#123; life: <span class="number">1340</span>, strength: <span class="number">451</span>, charisma: <span class="number">1020</span>, weapon: <span class="number">939</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">monsters_attack</span></span>(monsters: &amp;[&amp;Monster]) &#123;</span><br><span class="line">    <span class="keyword">for</span> monster <span class="keyword">in</span> monsters.iter() &#123;</span><br><span class="line">        monster.attack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> monkey: &amp;IndustrialRaverMonkey               = &amp;Monster::new();</span><br><span class="line">    <span class="keyword">let</span> angel: &amp;DwarvenAngel                         = &amp;Monster::new();</span><br><span class="line">    <span class="keyword">let</span> tentacle: &amp;AssistantViceTentacleAndOmbudsman = &amp;Monster::new();</span><br><span class="line">    <span class="keyword">let</span> deer: &amp;TeethDeer                             = &amp;Monster::new();</span><br><span class="line">    <span class="keyword">let</span> cyclist: &amp;IntrepidDecomposedCyclist          = &amp;Monster::new();</span><br><span class="line">    <span class="keyword">let</span> dragon: &amp;Dragon                              = &amp;Monster::new();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dwemthys_vector: &amp;[&amp;Monster] = [monkey <span class="keyword">as</span> &amp;Monster, angel <span class="keyword">as</span> &amp;Monster, tentacle <span class="keyword">as</span> &amp;Monster, deer <span class="keyword">as</span> &amp;Monster, cyclist <span class="keyword">as</span> &amp;Monster, dragon <span class="keyword">as</span> &amp;Monster];</span><br><span class="line"></span><br><span class="line">    monsters_attack(dwemthys_vector);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Congrats! You’ve mastered Traits. They’re pretty awesome, right?</p>

	     
	         <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="https://github.com/scalaview"><strong>scalaview</strong></a> - 2016-11-07</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://scalaview.github.io"><strong>王见充时光</strong></a></span>
</p>
       	
      
    </div>
    <footer>
      
	 
     		  
       		
     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-rust_for_rubyists/chapter-10" data-title="" data-url="http://scalaview.github.io/2016/11/07/rust_for_rubyists/chapter-10/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'scalaview'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>
</body>
</html>