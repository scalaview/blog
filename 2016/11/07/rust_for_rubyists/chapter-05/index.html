<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>王见充时光</title>
  <meta name="author" content="Benko bin">
  
  <meta name="description" content="FizzBuzzOf course, the first thing that your job interview for that cushy newRust job will task you with is building FizzBuzz. Let’s do it!
If you’re ">
  
  
  
  <meta property="og:site_name" content="王见充时光"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta property="og:image" content="undefined"/>
  
   <link rel="apple-touch-icon" href="/icon.png" />
   <link rel="shortcut icon" href="/favicon.ico" >
   <link rel="alternate" href="http://xxx.xx/atom.xml" title="王见充时光" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.min.js"></script>
</head>


<body>
  <div id="content" class="inner">
    <aside id="sidebar" class="alignleft">
      <div class="navigationBar">
        <a href="/">王见充时光</a>
      </div>
    	
  <nav class="widget" id="menu">
	<ul>
    
      <li class="cell"><a class="next" href="/">Home</a><li>
    
      <li class="cell"><a class="next" href="/archives/">Archives</a><li>
    
      <li class="cell"><a class="next" href="/about/">About</a><li>
    
      <li class="cell"><a class="next" href="/atom.xml">Subscribe</a><li>
    
    </ul>
</nav>

  

  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Android/" style="font-size: 20px;">Android</a><a href="/tags/Data-Storage/" style="font-size: 10px;">Data Storage</a><a href="/tags/Java/" style="font-size: 15px;">Java</a><a href="/tags/Jquery/" style="font-size: 10px;">Jquery</a><a href="/tags/RecyclerView/" style="font-size: 10px;">RecyclerView</a><a href="/tags/Service/" style="font-size: 10px;">Service</a><a href="/tags/Thread/" style="font-size: 10px;">Thread</a><a href="/tags/listView/" style="font-size: 10px;">listView</a><a href="/tags/优化/" style="font-size: 10px;">优化</a>
  </div>
</div>


    	<footer id="footer" class="inner"><div class="copyright">
  
  &copy; 2016 Benko bin
  
</div>



</footer>
    </aside>
    
    
    <div id="hidden-navigationBar" class="navigationBar">
      <a href="/">王见充时光</a>
    </div>
    <div id="main-col" class="alignright">
    <div id="wrapper">
      
<article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
  <header>
      
      
  
    <h1 class="title"></h1>
  

      <time datetime="2016-11-07T02:43:08.780Z"><a href="/2016/11/07/rust_for_rubyists/chapter-05/">2016-11-07</a></time>
      
  </header>
    <div class="entry">
      
        <h1 id="FizzBuzz">FizzBuzz</h1><p>Of course, the first thing that your job interview for that cushy new<br>Rust job will task you with is building FizzBuzz. Let’s do it!</p>
<p>If you’re not familiar, FizzBuzz is a simple programming problem:</p>
<blockquote>
<p>“Write a program that prints the numbers from 1 to 100. But for multiples of<br>three print “Fizz” instead of the number and for the multiples of five print<br>“Buzz”. For numbers which are multiples of both three and five print<br>“FizzBuzz”.”</p>
</blockquote>
<p>This will give us a good excuse to go over some basics of Rust: Looping,<br>tests, printing to standard output, and a host of other simple things.</p>
<p>First, a test. This will go in fizzbuzz.rs:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> div_by_three(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"One is not three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And compile it:</p>
<pre><code>$ rustc --test fizzbuzz.rs
fizzbuzz.rs:3:8: 3:20 error: unresolved name `div_by_three`.
fizzbuzz.rs:3     if div_by_three(1) {
                     ^<span class="comment"><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    error: aborting due to previous error&#10;&#10;&#10;This makes sense: We haven&#39;t defined any functions yet. Let&#39;s define&#10;one:&#10;&#10;```rust&#10;fn div_by_three(num: int) -&#62; bool &#123;&#10;   true&#10;&#125;&#10;&#10;#[test]&#10;fn test_div_by_three() &#123;&#10;    if div_by_three(1) &#123;&#10;        panic!(&#34;One is not three&#34;);&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></span>
</code></pre><p>Okay. Here’s some new syntax. The <code>num: int</code> says that we take one<br>argument, <code>num</code>, and that it’s of an integer type. The <code>-&gt; bool</code> says<br>that we return a boolean, and the <code>true</code>, well, returns true. Just like<br>Ruby, the value of the last expression gets returned.</p>
<p>You’ll also note we have an <code>if</code> expression. It’s pretty close to what<br>you’d expect, but we have curly braces rather than our friends <code>do/end</code>.</p>
<p>Now that we’ve got that cleared up, let’s compile and run our tests:</p>
<pre><code>$ rustc --test fizzbuzz.rs
fizzbuzz.<span class="string">rs:</span><span class="number">1</span>:<span class="number">17</span>: <span class="number">1</span>:<span class="number">18</span> <span class="string">warning:</span> unused <span class="string">variable:</span> `num`, #[warn(unused_variable)] on by <span class="keyword">default</span>
fizzbuzz.<span class="string">rs:</span><span class="number">1</span> fn div_by_three(<span class="string">num:</span> <span class="typename">int</span>) -&gt; bool {
                              ^

$ ./fizzbuzz
running <span class="number">1</span> test
test test_div_by_three ... FAILED
<span class="label">
failures:</span>

---- test_div_by_three stdout ----
    task <span class="string">'test_div_by_three'</span> failed at <span class="string">'One is not three'</span>, fizzbuzz.<span class="string">rs:</span><span class="number">8</span>
<span class="label">


failures:</span>
    test_div_by_three

test <span class="string">result:</span> FAILED. <span class="number">0</span> passed; <span class="number">1</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured

task <span class="string">'&lt;main&gt;'</span> failed at <span class="string">'Some tests failed'</span>, <span class="regexp">/home/</span>steve<span class="regexp">/src/</span>rust<span class="regexp">/src/</span>libtest/lib.<span class="string">rs:</span><span class="number">243</span>
</code></pre><p>Rust is kind enough to give us a warning: we never used the <code>num</code><br>argument. We then get our failure, “One is not three”, because we<br>returned true. Now that we have a failing test, let’s make it pass:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">div_by_three</span></span>(num: <span class="keyword">int</span>) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">   <span class="keyword">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> div_by_three(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"One is not three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TDD means do the simplest thing! Compile and run it:</p>
<pre><code>$ rustc --test fizzbuzz.rs
fizzbuzz.rs:<span class="number">1</span>:<span class="number">17</span>: <span class="number">1</span>:<span class="number">18</span> warning: unused variable: `num`, <span class="comment">#[warn(unused_variable)] on by default</span>
fizzbuzz.rs:<span class="number">1</span> fn div_by_three(num: <span class="type">int</span>) -&gt; <span class="type">bool</span> {
                              ^

$ ./fizzbuzz
running <span class="number">1</span> test
test test_div_by_three ... ok

test <span class="literal">result</span>: ok. <span class="number">1</span> passed; <span class="number">0</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured
</code></pre><p>Awesome! We pass! We still have that warning, though… let’s write<br>another test, and see what happens:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">div_by_three</span></span>(num: <span class="keyword">int</span>) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">   <span class="keyword">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> div_by_three(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"One is not three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three_with_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> !div_by_three(<span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"Three should be three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>$ rustc --test fizzbuzz.rs
fizzbuzz.<span class="string">rs:</span><span class="number">1</span>:<span class="number">17</span>: <span class="number">1</span>:<span class="number">18</span> <span class="string">warning:</span> unused <span class="string">variable:</span> `num`, #[warn(unused_variable)] on by <span class="keyword">default</span>
fizzbuzz.<span class="string">rs:</span><span class="number">1</span> fn div_by_three(<span class="string">num:</span> <span class="typename">int</span>) -&gt; bool {
                              ^


$ ./fizzbuzz
running <span class="number">2</span> tests
test test_div_by_three ... ok
test test_div_by_three_with_three ... FAILED
<span class="label">
failures:</span>

---- test_div_by_three_with_three stdout ----
    task <span class="string">'test_div_by_three_with_three'</span> failed at <span class="string">'Three should be three'</span>, fizzbuzz.<span class="string">rs:</span><span class="number">15</span>
<span class="label">


failures:</span>
    test_div_by_three_with_three

test <span class="string">result:</span> FAILED. <span class="number">1</span> passed; <span class="number">1</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured

task <span class="string">'&lt;main&gt;'</span> failed at <span class="string">'Some tests failed'</span>, <span class="regexp">/home/</span>steve<span class="regexp">/src/</span>rust<span class="regexp">/src/</span>libtest/lib.<span class="string">rs:</span><span class="number">243</span>
</code></pre><p>Great! It showed that our first test passed, and that our second one<br>failed. Let’s make both tests pass:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">div_by_three</span></span>(num: <span class="keyword">int</span>) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> num % <span class="number">3</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> div_by_three(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"One is not three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_three_with_three</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> !div_by_three(<span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">panic!</span>(<span class="string">"Three should be three"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>$ rustc --test fizzbuzz.rs &amp;&amp; ./fizzbuzz
running <span class="number">2</span> tests
test test_div_by_three_with_three ... ok
test test_div_by_three ... ok

test <span class="literal">result</span>: ok. <span class="number">2</span> passed; <span class="number">0</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured
</code></pre><p>Awesome! This shows off how elses work, as well. It’s probably what you<br>expected. Go ahead and try to refactor this into a one-liner.</p>
<p>Done? How’d you do? Here’s mine:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">div_by_three</span></span>(num: <span class="keyword">int</span>) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">    num % <span class="number">3</span> == <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Wait, whaaaat? Remember, the last thing in a function is a return in Rust,<br>but there’s one wrinkle: note there’s no semicolon here. If you had one,<br>you’d get:</p>
<pre><code>$ rustc --test fizzbuzz.rs
fizzbuzz.<span class="string">rs:</span><span class="number">2</span>:<span class="number">15</span>: <span class="number">2</span>:<span class="number">16</span> <span class="string">note:</span> consider removing <span class="keyword">this</span> <span class="string">semicolon:</span>
fizzbuzz.<span class="string">rs:</span><span class="number">2</span>     num % <span class="number">3</span> == <span class="number">0</span>;
                            ^
fizzbuzz.<span class="string">rs:</span><span class="number">1</span>:<span class="number">1</span>: <span class="number">3</span>:<span class="number">2</span> <span class="string">error:</span> not all control paths <span class="keyword">return</span> a value
fizzbuzz.<span class="string">rs:</span><span class="number">1</span> fn div_by_three(<span class="string">num:</span> <span class="typename">int</span>) -&gt; bool {
fizzbuzz.<span class="string">rs:</span><span class="number">2</span>     num % <span class="number">3</span> == <span class="number">0</span>;
fizzbuzz.<span class="string">rs:</span><span class="number">3</span> }
<span class="string">error:</span> aborting due to previous error
</code></pre><p>Basically, ending an expression in Rust with a semicolon ignores the<br>value of that expression. Another way to think about it is that the<br>semicolon turns the expression into a statement, and statements don’t<br>have values. This is kinda weird. It becomes natural after some use, though.<br>And Rust is even smart enough to tell us that it’s probably a problem!</p>
<p>Okay, now try to TDD out the <code>div_by_five</code> and <code>div_by_fifteen</code> methods. They<br>should work the same way, but this will let you get practice actually<br>writing it out. Once you see this, you’re ready to advance:</p>
<pre><code>$ rustc --test fizzbuzz.rs &amp;&amp; ./fizzbuzz

running <span class="number">6</span> tests
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_fifteen ... ok
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_five_with_five ... ok
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_five ... ok
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_fifteen_with_fifteen ... ok
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_three ... ok
<span class="built_in">test</span> <span class="built_in">test</span>_div_by_three_with_three ... ok

<span class="built_in">test</span> result: ok. <span class="number">6</span> passed; <span class="number">0</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured
</code></pre><p>Okay! Let’s talk about the main program now. We’ve got the tools to<br>build FizzBuzz, let’s make it work. First thing we need to do is print<br>out all the numbers from one to 100. It’s easy!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"num"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Step one: print <strong>something</strong> 100 times. If you run this via<br><code>rustc fizzbuzz.rs &amp;&amp; ./fizzbuzz</code> you should see <code>num</code> printed<br>100 times. Note that our tests didn’t actually run. Not only are they not run,<br>they’re actually not even in the executable:</p>
<p>Compile with the test flag:</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rustc <span class="comment">--test fizzbuzz.rs</span></span><br></pre></td></tr></table></figure>
<p>On Linux:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">nm</span> -C fizzbuzz | <span class="keyword">grep</span> test</span><br></pre></td></tr></table></figure>
<p>On OS X:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">nm</span> fizzbuzz | <span class="keyword">c</span>++filt -<span class="keyword">p</span> -<span class="keyword">i</span> | <span class="keyword">grep</span> test</span><br></pre></td></tr></table></figure>
<p>Expected output:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000403</span>cd0 t test_div_by_five_with_five::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000403</span>ac0 t test_div_by_three_with_three::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000403</span>c10 t test_div_by_five_with_not_five::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000403</span>ee0 t test_div_by_fifteen_with_fifteen::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000403</span>a00 t test_div_by_three_with_not_three::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000403e20</span> t test_div_by_fifteen_with_not_fifteen::_79fbef3fc431adf6::_00</span><br><span class="line">                 U test::test_main_static::_e5d562a4bc8c4dd6::_06</span><br><span class="line"><span class="number">000000000040f</span>ea0 T __test::main::_79fbef3fc431adf6::_00</span><br><span class="line"><span class="number">0000000000614890</span> D __test::tests::_7c31a8a9617a6a::_00</span><br></pre></td></tr></table></figure>
<p>Compile without the test flag:</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rustc fizzbuzz.rs</span><br></pre></td></tr></table></figure>
<p>On Linux:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">nm</span> -C fizzbuzz | <span class="keyword">grep</span> test</span><br></pre></td></tr></table></figure>
<p>On OS X:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">nm</span> fizzbuzz | <span class="keyword">c</span>++filt -<span class="keyword">p</span> -<span class="keyword">i</span> | <span class="keyword">grep</span> test</span><br></pre></td></tr></table></figure>
<p>Expected output:</p>
<pre><code>$
</code></pre><p>Neat, huh? Rust is smart.</p>
<p>Anyway, <code>nm</code>: The <code>nm</code> program lists all the symbols in a binary executable or<br>library. The <code>-C</code> option is important on linux, it “de-mangles” the symbol names.<br>On OS X, <code>nm</code> provides no symbol de-mangling option, so the output must be piped to <code>c++filt</code>. Rust<br>uses the same mangling scheme as C++, so it’s compatible with all the existing<br>tools. How it works isn’t that important, though.  It’s cool low-level stuff if<br>you’re into that sort of thing.</p>
<p>Anywho, where were we? Oh, iteration:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This uses string interpolation: the double curlies tell Rust where to place<br><code>num</code> in the string.</p>
<p>Anyway, now we have 1 to 99. We need 1 to 100.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we can put the two together:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> answer;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> div_by_fifteen(num)&#123;</span><br><span class="line">            answer = <span class="string">"FizzBuzz"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> div_by_three(num) &#123;</span><br><span class="line">            answer = <span class="string">"Fizz"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> div_by_five(num) &#123;</span><br><span class="line">            answer = <span class="string">"Buzz"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            answer = <span class="string">""</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Uhhhh <code>let mut</code>? <code>let</code> is the way that we make a local variable. <code>mut</code><br>means we plan to mutate that variable: yes, variables are immutable by<br>default.</p>
<p>We can shorten this up a bit with this syntax:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> answer =</span><br><span class="line">            <span class="keyword">if</span> div_by_fifteen(num)&#123;</span><br><span class="line">                <span class="string">"FizzBuzz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_three(num) &#123;</span><br><span class="line">                <span class="string">"Fizz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_five(num) &#123;</span><br><span class="line">                <span class="string">"Buzz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="string">""</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ve made the <code>if</code> assign the value to answer. Note that we had to<br>remove the semicolons again; that lets the expression give its value to<br><code>answer.</code> Note that this <em>also</em> makes answer immutable, so we can<br>remove the <code>mut</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> answer =</span><br><span class="line">            <span class="keyword">if</span> div_by_fifteen(num)&#123;</span><br><span class="line">                <span class="string">"FizzBuzz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_three(num) &#123;</span><br><span class="line">                <span class="string">"Fizz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_five(num) &#123;</span><br><span class="line">                <span class="string">"Buzz"</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="string">""</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Not too shabby! I love eliminating mutable state.</p>
<p>Of course, this version gives us lots of empty lines, so what we<br>actually want is:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> answer =</span><br><span class="line">            <span class="keyword">if</span> div_by_fifteen(num)&#123;</span><br><span class="line">                <span class="string">"FizzBuzz"</span>.to_string()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_three(num) &#123;</span><br><span class="line">                <span class="string">"Fizz"</span>.to_string()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_five(num) &#123;</span><br><span class="line">                <span class="string">"Buzz"</span>.to_string()</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                num.to_string()</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, answer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Why the “<code>to_string()</code>“s? There are two types of Strings in Rust: <code>String</code>,<br>which is a heap allocated string with dynamic length, and <code>&amp;str</code>, which<br>is a borrowed, immutable view into a string. The literal is of type <code>&amp;str</code>,<br>but we want a <code>String</code>. <code>to_string()</code> turns a <code>&amp;str</code> into a <code>String</code>.</p>
<p>Before, we could get away with a <code>&amp;str</code>, because they all had the same<br>type. But since we’ve added an arm with an <code>int</code>, we need to make them all<br>the same type, and there’s no way to convert an <code>int</code> into a <code>&amp;str</code>.</p>
<p>Because the <code>if</code> returns a value, we could also do something like this:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">1</span>i, <span class="number">101</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"&#123;&#125;"</span>, </span><br><span class="line">            <span class="keyword">if</span> div_by_fifteen(num) &#123; <span class="string">"FizzBuzz"</span>.to_string() &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_three(num) &#123; <span class="string">"Fizz"</span>.to_string() &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> div_by_five(num) &#123; <span class="string">"Buzz"</span>.to_string() &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; num.to_string() &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s more compact, and removes the intermediate variable all together.</p>
<p>We can do one other thing too: this whole <code>if/panic!</code> thing so common in<br>tests seems too complex. Why do we have to write if over and over and<br>over again? Meet <code>assert!</code>:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">test_div_by_fifteen_with_fifteen</span></span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(div_by_fifteen(<span class="number">15</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This will fail if it gets false, and pass if it gets true. Simple! You<br>can also give it a message to be printed when the assertion fails,<br>mostly useful when you are using <code>assert!</code> to test for preconditions and<br>such:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="built_in">assert!</span>(<span class="number">1</span> == <span class="number">0</span>, <span class="string">"1 does not equal 0!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Try running it.</p>
<p>Anyway, awesome! We’ve conquered FizzBuzz.</p>

	     
	         <p style="margin:20px 0; color:#9f9f9f; font-size:12px;">
<span>Posted by <a style="color:#9f9f9f;" href="https://github.com/scalaview"><strong>scalaview</strong></a> - 2016-11-07</span><br />
<span style="line-height:13px;">如需转载，请注明： 本文来自 <a style="color:#9f9f9f;" href="http://scalaview.github.io"><strong>王见充时光</strong></a></span>
</p>
       	
      
    </div>
    <footer>
      
	 
     		  
       		
     		  
       	 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-rust_for_rubyists/chapter-05" data-title="" data-url="http://scalaview.github.io/2016/11/07/rust_for_rubyists/chapter-05/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'scalaview'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
</div>
    </div>
    <div class="tabbar" onload="divideTabBar()">
	
      <div class="tabbaritem"><a class="next" href="/">Home</a></div>
    
      <div class="tabbaritem"><a class="next" href="/archives/">Archives</a></div>
    
      <div class="tabbaritem"><a class="next" href="/about/">About</a></div>
    
      <div class="tabbaritem"><a class="next" href="/atom.xml">Subscribe</a></div>
    
</div>


  </div>
</body>
</html>